# ุญู ูุดููุฉ ุฎุทุฃ 500 ุนูุฏ ุทูุจ Video Token

## ุงููุดููุฉ
```
๐ฅ Response Status: 500
๐ฅ Response Body: {"statusCode":500,"message":"Internal server error"}
โ Error requesting token: Exception: ูุดู ุงูุญุตูู ุนูู token (500)
```

## ุงูุณุจุจ ุงููุญุชูู
ุงูุฎุทุฃ 500 ูุนูู ุฃู ููุงู ูุดููุฉ ูู ุงูุจุงููุฏ ุนูุฏ ุชูููุฏ token ูู Agora. ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:

1. **ุฅุนุฏุงุฏุงุช Agora ุบูุฑ ููุฌูุฏุฉ ุฃู ุบูุฑ ุตุญูุญุฉ**
2. **App Certificate ุบูุฑ ููุฌูุฏ ุฃู ุบูุฑ ุตุญูุญ**
3. **ูุดููุฉ ูู ุงูุงุชุตุงู ุจู Agora**
4. **ูุดููุฉ ูู ุชูููุฏ Token**

## ุงูุญููู

### ุงูุญู 1: ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช Agora ูู ุงูุจุงููุฏ

1. **ุงูุชุญ Swagger** ุฃู ุงุณุชุฎุฏู Admin Dashboard
2. **ุชุญูู ูู ุฅุนุฏุงุฏุงุช Agora**:
   ```
   GET /v1/admin/settings/agora
   ```
3. **ุชุฃูุฏ ูู**:
   - `isEnabled: true`
   - `appId` ููุฌูุฏ ูููุณ ูุงุฑุบุงู
   - `appCertificate` ููุฌูุฏ ูููุณ ูุงุฑุบุงู

### ุงูุญู 2: ุฅุนุงุฏุฉ ุฅุนุฏุงุฏ Agora

ุงุณุชุฎุฏู Swagger ุฃู Admin Dashboard:

```bash
PATCH /v1/admin/settings/agora
Headers: Authorization: Bearer {admin_token}
Body: {
  "appId": "YOUR_AGORA_APP_ID",
  "appCertificate": "YOUR_AGORA_APP_CERTIFICATE",
  "tokenExpirationTime": 3600,
  "isEnabled": true
}
```

### ุงูุญู 3: ุงุฎุชุจุงุฑ ุงุชุตุงู Agora

```bash
POST /v1/admin/settings/agora/test
Headers: Authorization: Bearer {admin_token}
```

ูุฌุจ ุฃู ุชุญุตู ุนูู:
```json
{
  "success": true,
  "message": "Agora connection test successful"
}
```

ุฅุฐุง ูุดู ุงูุงุฎุชุจุงุฑุ ุชุญูู ูู:
- ุตุญุฉ App ID ู App Certificate
- ุฃู Agora account ูุดุท
- ุฃู App ID ู Certificate ูุฑุชุจุทุงู ุจููุณ ุงููุดุฑูุน

### ุงูุญู 4: ุงูุชุญูู ูู Logs ุงูุจุงููุฏ

ุงูุชุญ logs ุงูุจุงููุฏ ูุงุจุญุซ ุนู:
- ุฃุฎุทุงุก Agora
- ุฃุฎุทุงุก ูู ุชูููุฏ Token
- ุฃุฎุทุงุก ูู ุฅุนุฏุงุฏุงุช Agora

### ุงูุญู 5: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจุงููุฏ

ุจุนุฏ ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุชุ ุฃุนุฏ ุชุดุบูู ุงูุจุงููุฏ:

```bash
# ุฅุฐุง ููุช ุชุณุชุฎุฏู npm
npm run start:dev

# ุฃู ุฅุฐุง ููุช ุชุณุชุฎุฏู docker
docker-compose restart
```

## ููููุฉ ุงูุญุตูู ุนูู App ID ู App Certificate

1. **ุณุฌู ุฏุฎููู ุฅูู [Agora Console](https://console.agora.io)**
2. **ุฃูุดุฆ ูุดุฑูุน ุฌุฏูุฏ** ุฃู ุงุฎุชุฑ ูุดุฑูุน ููุฌูุฏ
3. **ุงููุฑ ุนูู ุงููุดุฑูุน**
4. **ุงูุณุฎ App ID** ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
5. **ุงููุฑ ุนูู "Edit" ุจุฌุงูุจ App Certificate**
6. **ุงูุณุฎ App Certificate** (ุฃู ุฃูุดุฆ ูุงุญุฏ ุฌุฏูุฏ)

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ

ุจุนุฏ ุฅุตูุงุญ ุงูุฅุนุฏุงุฏุงุช:

1. **ุงุฎุชุจุฑ ุงูุงุชุตุงู**:
   ```bash
   POST /v1/admin/settings/agora/test
   ```

2. **ุฌุฑุจ ุจุฏุก ููุงููุฉ ููุฏูู** ูู ุงูุชุทุจูู

3. **ูุฌุจ ุฃู ุชุฑู ูู logs**:
   ```
   โ Video token generated successfully
   ```

## ููุงุญุธุงุช ูููุฉ

- **App Certificate ุญุณุงุณ**: ุชุฃูุฏ ูู ุนุฏู ูุดุงุฑูุชู ุนููุงู
- **App ID ู Certificate ูุฌุจ ุฃู ููููุง ูู ููุณ ุงููุดุฑูุน**
- **Token Expiration Time**: ุงูุชุฑุงุถู 3600 ุซุงููุฉ (ุณุงุนุฉ ูุงุญุฏุฉ)

## ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

1. ุชุญูู ูู logs ุงูุจุงููุฏ ุจุงูุชูุตูู
2. ุชุฃูุฏ ูู ุฃู `agora-token` package ูุซุจุช ูู ุงูุจุงููุฏ
3. ุชุฃูุฏ ูู ุฃู MongoDB ูุนูู ุจุดูู ุตุญูุญ (ูุญูุธ ุงูุฅุนุฏุงุฏุงุช)
4. ุชุญูู ูู ุฃู ุงูุจุงููุฏ ูุนูู ุนูู ููุณ ุงูุจูุฑุช ุงููุชููุน

